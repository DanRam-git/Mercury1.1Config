# Mercury 1.1------------------------------------------------------------
[include mainsail.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_2F0025001251313531383332-if00

[printer]
kinematics: corexy
max_velocity: 300
#   Maximum velocity (in mm/s) of the toolhead (relative to the
#   print). This value may be changed at runtime using the
#   SET_VELOCITY_LIMIT command. This parameter must be specified.
max_accel: 3000
#   Maximum acceleration (in mm/s^2) of the toolhead (relative to the
#   print). Although this parameter is described as a "maximum"
#   acceleration, in practice most moves that accelerate or decelerate
#   will do so at the rate specified here. The value specified here
#   may be changed at runtime using the SET_VELOCITY_LIMIT command.
#   This parameter must be specified.
max_z_velocity: 8
max_z_accel: 20

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5

########################################
# TMC2209 configuration
########################################

#[tmc2209 stepper_y]
#uart_pin: PD11
##diag_pin: PG9
#uart_address: 0 
#run_current: 0.800
#stealthchop_threshold: 999999

#----------------------------------------y Axis (A Motor, Back Left)---------------------------------------

[stepper_y] #Driver0
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14

microsteps: 32
full_steps_per_rotation: 200
rotation_distance: 40
#rotation_distance = <full_steps_per_rotation> * <microsteps> / <steps_per_mm>
#rotation_distance = 200 * 32 / 160

endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: 0
position_max: 370
homing_speed: 50

[tmc2209 stepper_y]
uart_pin: PC4
diag_pin: PG6
#uart_address: 0 
run_current: .9
stealthchop_threshold: 999999
driver_SGTHRS: 75

#----------------------------------------x Axis (B Motor, Back Right) ---------------------------------------

[stepper_x] #Driver1
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15

microsteps: 32
full_steps_per_rotation: 200
rotation_distance: 40
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 0
position_max: 370
homing_speed: 50

[tmc2209 stepper_x]
uart_pin: PD11
diag_pin: PG9
#uart_address: 0 
run_current: .9
stealthchop_threshold: 999999
driver_SGTHRS: 75

#---------------------------------------- Hydra Stepper Config ---------------------------------------

[stepper_z] # Rear Z motor (Facing Printer) Motor 3
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
microsteps: 32
full_steps_per_rotation: 200
rotation_distance: 2

endstop_pin: tmc2209_stepper_z:virtual_endstop
position_endstop: 0
position_max: 350
position_min: 0
homing_speed: 4
second_homing_speed: 2
homing_retract_dist: 1

[tmc2209 stepper_z]
uart_pin: PC7
diag_pin: PG11
run_current: .6
stealthchop_threshold: 999999
driver_SGTHRS: 20

#[stepper_z1] # Right Z motor (Facing Printer) Motor 4
#step_pin: PF9
#dir_pin: !PC10
#enable_pin: !PG2
#microsteps: 32
#full_steps_per_rotation: 200
#rotation_distance: 2

#endstop_pin: tmc2209_stepper_z1:virtual_endstop
#position_endstop: 0
#position_max: 350
#position_min: 0
#homing_speed: 4
#second_homing_speed: 2
#homing_retract_dist: 1

#[tmc2209 stepper_z1]
#uart_pin: PF2
#diag_pin: PG12

#run_current: 0.6
#stealthchop_threshold: 999999
#driver_SGTHRS: 45

#[stepper_z2] # Left Z motor (Facing printer) Motor 5
#step_pin: PC13
#dir_pin: PF0
#enable_pin: !PF1
#microsteps: 32
#full_steps_per_rotation: 200
#rotation_distance: 2

#endstop_pin: tmc2209_stepper_z2:virtual_endstop
#position_endstop: 0
#osition_max: 350
#position_min: 0
#homing_speed: 4
#second_homing_speed: 2
#homing_retract_dist: 1

#[tmc2209 stepper_z2]
#uart_pin: PE4
#diag_pin: PG13
#run_current: 0.6
#stealthchop_threshold: 999999
#driver_SGTHRS: 45

#-----------------------------------------------EXTRUDER---------------------------------------

#[extruder]
#step_pin: PA4
#dir_pin: PA6
#enable_pin: !PA2
#microsteps: 16
#rotation_distance: 33.500
#full_steps_per_rotation:
#gear_ratio:
#   See the "stepper" section for a description of the above
#   parameters. If none of the above parameters are specified then no
#   stepper will be associated with the nozzle hotend (though a
#   SYNC_EXTRUDER_MOTION command may associate one at run-time).
#nozzle_diameter: 0.400
#   Diameter of the nozzle orifice (in mm). This parameter must be
#   provided.
#filament_diameter: 1.750
#   The nominal diameter of the raw filament (in mm) as it enters the
#   extruder. This parameter must be provided.
#heater_pin: PB4
#   PWM output pin controlling the heater. This parameter must be
#   provided.
#sensor_type: ATC Semitec 104GT-2
#   Type of sensor - common thermistors are "EPCOS 100K B57560G104F",
#   "ATC Semitec 104GT-2", "ATC Semitec 104NT-4-R025H42G", "Generic
#   3950","Honeywell 100K 135-104LAG-J01", "NTC 100K MGB18-104F39050L32",
#   "SliceEngineering 450", and "TDK NTCG104LH104JT1". See the
#   "Temperature sensors" section for other sensors. This parameter
#   must be provided.
#sensor_pin: PK5
#   Analog input pin connected to the sensor. This parameter must be
#   provided.
#control: pid
#   Control algorithm (either pid or watermark). This parameter must
#   be provided.
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114
#   The proportional (pid_Kp), integral (pid_Ki), and derivative
#   (pid_Kd) settings for the PID feedback control system. Klipper
#   evaluates the PID settings with the following general formula:
#     heater_pwm = (Kp*error + Ki*integral(error) - Kd*derivative(error)) / 255
#   Where "error" is "requested_temperature - measured_temperature"
#   and "heater_pwm" is the requested heating rate with 0.0 being full
#   off and 1.0 being full on. Consider using the PID_CALIBRATE
#   command to obtain these parameters. The pid_Kp, pid_Ki, and pid_Kd
#   parameters must be provided for PID heaters.
#min_temp: 0
#max_temp: 250
#   The maximum range of valid temperatures (in Celsius) that the
#   heater must remain within. This controls a safety feature
#   implemented in the micro-controller code - should the measured
#   temperature ever fall outside this range then the micro-controller
#   will go into a shutdown state. This check can help detect some
#   heater and sensor hardware failures. Set this range just wide
#   enough so that reasonable temperatures do not result in an error.
#   These parameters must be provided.

#-----------------------------------------------Bed---------------------------------------

#[heater_bed]
#heater_pin: PH5
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: PK6
#control: watermark
#min_temp: 0
#max_temp: 130
#   See the "extruder" section for a description of the above parameters.

#---------------------------------------- Bed level ---------------------------------------

#[safe_z_home]
#home_xy_position: 137.5, 137.5
#   Sets the x, y position used for z homing with beacon

#z_hop: 3
#   Retracts the z axis before x, y homing to avoid dragging the nozzle.

#[bed_mesh]
#speed: 100
#horizontal_move_z: 2
#zero_reference_position: 137.5, 137.5
#mesh_min: 40, 40
#mesh_max: 250, 250
#probe_count: 5, 5

#[z_tilt]
#z_positions:
#    137.5, 265
#    15, 12
#    270, 12
#points:
#    260, 225
#    20, 225
#    20, 0
#    260, 0
#speed: 250
#horizontal_move_z: 5
#retries: 5
#retry_tolerance:0.150

#-----------------------------------------------Fans---------------------------------------

#[fan]
#pin: PH6
